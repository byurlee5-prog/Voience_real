<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Voience Real</title>
  <style>
    body { font-family: 'Roboto', Arial, sans-serif; margin:0; background:#F3F4F6; color:#1E3A8A; }
    header { background:#1E3A8A; color:white; padding:30px 20px; text-align:center; }
    header img { width:180px; margin-bottom:15px; }
    h1 { font-size:22px; line-height:1.6; margin:0; }
    main { max-width:800px; margin:30px auto; text-align:center; }
    .controls { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; margin-top:20px; }
    button { padding:14px 24px; font-size:16px; border:none; border-radius:8px; background:#2563EB; color:white; cursor:pointer; flex:1 1 140px; transition:.3s; }
    button:hover { background:#1E40AF; }
    #send { background:#E11D48; } #send:hover { background:#BE123C; }
    canvas { display:block; margin:20px auto; border:1px solid #ccc; width:100%; max-width:700px; height:180px; background:white; border-radius:8px; }
    audio { margin-top:20px; width:100%; max-width:700px; }
    input[type="file"] { display:none; }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Voience 로고">
    <h1>Voience(보이언스)<br>녹음 혹은 음성파일 업로드 후 보내기 버튼을 눌러주세요</h1>
  </header>
  <main>
    <canvas id="visualizer"></canvas>
    <div class="controls">
      <button id="record">녹음 시작</button>
      <button id="stop">녹음 종료</button>
      <button id="uploadBtn">업로드</button>
      <input type="file" id="fileInput" accept="audio/*">
      <button id="play">플레이</button>
      <button id="send">보내기</button>
<a href="https://kauth.kakao.com/oauth/authorize?client_id=REST_API_KEY&redirect_uri=https://voience-real.vercel.app/api/oauth&response_type=code">
  <button>카카오 로그인</button>
</a>

    </div>
    <audio id="player" controls style="display:none;"></audio>
  </main>
  <script>
    let mediaRecorder, audioChunks=[], audioBlob, audioContext, analyser, source, dataArray, canvas=document.getElementById("visualizer"), ctx=canvas.getContext("2d");
    function drawWaveform(){requestAnimationFrame(drawWaveform);if(!analyser)return;analyser.getByteTimeDomainData(dataArray);ctx.fillStyle="white";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.lineWidth=2;ctx.strokeStyle="#2563EB";ctx.beginPath();let sliceWidth=canvas.width*1.0/dataArray.length,x=0;for(let i=0;i<dataArray.length;i++){let v=dataArray[i]/128.0,y=v*canvas.height/2;if(i===0){ctx.moveTo(x,y);}else{ctx.lineTo(x,y);}x+=sliceWidth;}ctx.lineTo(canvas.width,canvas.height/2);ctx.stroke();}
    document.getElementById("record").onclick=async()=>{const stream=await navigator.mediaDevices.getUserMedia({audio:true});audioContext=new(window.AudioContext||window.webkitAudioContext)();analyser=audioContext.createAnalyser();source=audioContext.createMediaStreamSource(stream);source.connect(analyser);analyser.fftSize=2048;dataArray=new Uint8Array(analyser.fftSize);drawWaveform();mediaRecorder=new MediaRecorder(stream);audioChunks=[];mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);mediaRecorder.start();};
    document.getElementById("stop").onclick=()=>{mediaRecorder.stop();audioContext.close();mediaRecorder.onstop=()=>{audioBlob=new Blob(audioChunks,{type:'audio/wav'});};};
    document.getElementById("uploadBtn").onclick=()=>{document.getElementById("fileInput").click();};
    document.getElementById("fileInput").onchange=e=>{const file=e.target.files[0];if(file){audioBlob=file;const audioUrl=URL.createObjectURL(file);const player=document.getElementById("player");player.src=audioUrl;player.style.display="block";}};
    document.getElementById("play").onclick=()=>{if(audioBlob){const audioUrl=URL.createObjectURL(audioBlob);const player=document.getElementById("player");player.src=audioUrl;player.style.display="block";player.play();}};
    document.getElementById("send").onclick=async()=>{if(!audioBlob){alert("녹음 또는 업로드된 파일이 없습니다.");return;}const formData=new FormData();formData.append("file",audioBlob,"audio.wav");const res=await fetch("/api/send",{method:"POST",body:formData});const data=await res.json();alert(data.message||data.error);};
  </script>
</body>
</html>
